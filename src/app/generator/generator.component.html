<div class="p-3">
    @if (loggedIn) {
    <h1 class="text-4xl mb-4">Táº¡o khuyáº¿n mÃ£i</h1>
    @if (generatorBrandSetting?.voucherForms) {
    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
            <mat-panel-title>ThÃ´ng tin chung</mat-panel-title>
            <mat-panel-description>ThÃ´ng tin chung cá»§a khuyáº¿n mÃ£i</mat-panel-description>
        </mat-expansion-panel-header>
        <mat-form-field class="w-full lg:w-1/2">
            <mat-label>MÃ£ khuyáº¿n mÃ£i</mat-label>
            <input type="text" matInput required [(ngModel)]="voucher.id"
                (ngModelChange)="voucher.qrData = voucher.id" />
            <span matTextPrefix>{{generatorBrandSetting?.id}}-</span>
        </mat-form-field>
        <mat-form-field class="w-full lg:w-1/2">
            <mat-label>TÃªn gá»i khuyáº¿n mÃ£i</mat-label>
            <input type="text" matInput required [(ngModel)]="voucher.name" />
        </mat-form-field>
    </mat-expansion-panel>
    <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
            <mat-panel-title>Thiáº¿t káº¿</mat-panel-title>
            <mat-panel-description>Thiáº¿t káº¿ cá»§a khuyáº¿n mÃ£i</mat-panel-description>
        </mat-expansion-panel-header>
        <div>
            <mat-form-field class="w-full lg:w-1/2">
                <mat-label>MÃ£ hÃ¬nh ná»n</mat-label>
                <input type="text" matInput required [(ngModel)]="voucher.background"
                    (ngModelChange)="onAddBackground()" />
                <mat-hint>Id cá»§a áº£nh trÃªn Google Drive</mat-hint>
            </mat-form-field>
            @if (voucher?.sharedBackground) {
            HÃ£y truy cáº­p ngay: <a [href]="voucher?.sharedBackground" [target]="'_blank'"
                class="underline text-[red]">{{voucher?.sharedBackground}}</a> Ä‘á»ƒ láº¥y <strong>MÃ£
                hÃ¬nh ná»n </strong>chÃ­nh xÃ¡c.
            }
            <mat-form-field class="w-full lg:w-1/2">
                <mat-label>MÃ£/liÃªn káº¿t hÃ¬nh ná»n <strong class="text-[red]">chÃ­nh xÃ¡c</strong></mat-label>
                <input type="text" matInput required [(ngModel)]="voucher.correctBackground"
                    (ngModelChange)="onAddBackground()" />
            </mat-form-field>
            <mat-form-field class="w-full lg:w-1/2">
                <mat-label>KÃ­ch thÆ°á»›c hÃ¬nh áº£nh khuyáº¿n mÃ£i</mat-label>
                <input type="text" disabled matInput required [(ngModel)]="voucher.size" />
                <mat-hint [innerText]="'\<ngang\>x\<dá»c\>'"></mat-hint>
            </mat-form-field>
            <mat-form-field class="w-1/2 lg:w-1/4">
                <mat-label>KÃ­ch thÆ°á»›c mÃ£ QR trong khuyáº¿n mÃ£i</mat-label>
                <input type="number" matInput required [(ngModel)]="voucher.qrSize" (ngModelChange)="updateQr()" />
                <mat-hint [innerText]="'hÃ¬nh vuÃ´ng'"></mat-hint>
            </mat-form-field>
            <mat-form-field class="w-1/2 lg:w-1/4">
                <mat-label>Tá»a Ä‘á»™ mÃ£ QR trong khuyáº¿n mÃ£i</mat-label>
                <input type="text" matInput required [(ngModel)]="voucher.qrPosition"
                    (ngModelChange)="updateQrPosition()" />
                <mat-hint [innerText]="'\<x\>:\<y\>'"></mat-hint>
            </mat-form-field>
        </div>

        <mat-expansion-panel>
            <mat-expansion-panel-header>
                <mat-panel-title>Khuyáº¿n mÃ£i tÃ­ch Ä‘iá»ƒm</mat-panel-title>
                <mat-panel-description>Thiáº¿t káº¿ cá»§a khuyáº¿n mÃ£i tÃ­ch Ä‘iá»ƒm</mat-panel-description>
            </mat-expansion-panel-header>
            <div>
                <mat-form-field class="w-full lg:w-1/2">
                    <mat-label>MÃ£ tick</mat-label>
                    <input type="text" matInput [(ngModel)]="voucher.tickId" (ngModelChange)="updateTickImage()" />
                </mat-form-field>

                @if (voucher?.shareTick) {
                HÃ£y truy cáº­p ngay: <a [href]="voucher?.shareTick" [target]="'_blank'"
                    class="underline text-[red]">{{voucher?.shareTick}}</a> Ä‘á»ƒ láº¥y <strong>MÃ£
                    tick </strong>chÃ­nh xÃ¡c.
                }
                <mat-form-field class="w-full lg:w-1/2">
                    <mat-label>MÃ£/liÃªn káº¿t tick <strong class="text-[red]">chÃ­nh xÃ¡c</strong></mat-label>
                    <input type="text" matInput [(ngModel)]="voucher.correctTick" (ngModelChange)="updateTickImage()" />
                </mat-form-field>
                @if (voucher?.tickImage) {
                <img [src]="voucher?.tickImage" class="h-8" alt="tickImage" (load)="uploadTick($event)">
                }
                <div class="w-full flex flex-wrap">
                    @for (item of voucher?.ticks; track item; let index = $index) {
                    <mat-form-field class="w-1/2 lg:w-1/6">
                        <mat-label>KÃ­ch thÆ°á»›c tick {{index + 1 | number: '2.0-0'}}</mat-label>
                        <input type="number" matInput [(ngModel)]="item.size" (ngModelChange)="uploadTick(item)" />
                        <mat-hint [innerText]="'hÃ¬nh vuÃ´ng'"></mat-hint>
                    </mat-form-field>
                    }
                    @if (voucher?.tickImage) {
                    <button mat-stroked-button [color]="'primary'" class="w-1/2 lg:w-1/6"
                        (click)="uploadTick('add')">ThÃªm
                        tick</button>
                    }
                </div>

            </div>
        </mat-expansion-panel>
        @if (downloading) {
        <div class="absolute top-0 right-0 bottom-0 left-0 flex justify-center items-center">
            <mat-spinner></mat-spinner>
        </div>
        }
        <app-voucher-image [voucher]="voucher" (updateImageSize)="updateImageSize($event)"
            (updateQrPosition)="updateQrPosition($event)"
            (uploadTick)="uploadTick($event?.event, $event.item)"></app-voucher-image>

        <div class="text-center">
            <button mat-raised-button color="primary" (click)="saveData()"
                [disabled]="downloading"
                class="w-full">
                <mat-icon>save</mat-icon> LÆ°u Dá»¯ Liá»‡u Máº«u Khuyáº¿n MÃ£i
            </button>
        </div>
        @if (googleFormsPath) {
        <button class="w-full" mat-stroked-button [color]="'primary'" (click)="googleFormsPath = ''">ÄÃ³ng biá»ƒu
            máº«u</button>
        <div><strong class="text-[red]">LÆ¯U Ã:</strong> HÃ£y áº¤n nÃºt "Gá»­i" hoáº·c "Submit" trong Biá»…u Máº«u bÃªn dÆ°á»›i ğŸ‘‡ğŸ‘‡ğŸ‘‡
            thÃ¬ báº¡n má»›i hoÃ n thÃ nh viá»‡c Ä‘Äƒng kÃ½ nhÃ©!</div>
        <div><strong class="text-[red]">LÆ¯U Ã:</strong> Má»—i khi hoÃ n thÃ nh viá»‡c táº¡o báº¡n nhá»› áº¥n nÃºt "ÄÃ³ng biá»ƒu máº«u Ä‘á»ƒ lÃ m
            má»›i nhÃ©!"</div>
        <iframe [src]="googleFormsPath | safe" class="w-full min-h-96" frameborder="0"></iframe>
        <div><strong class="text-[red]">LÆ¯U Ã:</strong> HÃ£y áº¤n nÃºt "Gá»­i" hoáº·c "Submit" trong Biá»…u Máº«u bÃªn trÃªn ğŸ‘†ğŸ‘†ğŸ‘†
            thÃ¬ báº¡n má»›i hoÃ n thÃ nh viá»‡c Ä‘Äƒng kÃ½ nhÃ©!</div>
        <div><strong class="text-[red]">LÆ¯U Ã:</strong> Má»—i khi hoÃ n thÃ nh viá»‡c táº¡o báº¡n nhá»› áº¥n nÃºt "ÄÃ³ng biá»ƒu máº«u Ä‘á»ƒ lÃ m
            má»›i nhÃ©!"</div>
        }
    </mat-expansion-panel>
    } @else {
    <div class="h-full flex justify-center items-center flex-col">
        <div>Äang tÃ¬m kiáº¿m biá»ƒu máº«u táº¡o khuyáº¿n mÃ£i cá»§a báº¡n</div>
        <mat-spinner></mat-spinner>
    </div>
    }
    }
</div>